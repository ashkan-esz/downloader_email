version: '3.4'

services:
  mailService:
    image: downloader-email
    depends_on:
      - mailServer
    network_mode: host
    build:
      context: .
      dockerfile: ./Dockerfile
      network: host
    env_file: ./.env
    environment:
      MAIN_SERVER_ADDRESS: api.movieTracker.site
      CORS_ALLOWED_ORIGINS: https://www.movietracker.site --- https://movietracker.site --- http://movietracker.site --- https://admin.movietracker.site --- http://admin.movietracker.site
      MAILSERVER_HOST: localhost
      MAILSERVER_PORT: 587
      MAILSERVER_USERNAME: webmaster@movietracker.site
      LOG_PANIC_TRACE: 'true'
      INITIAL_WAIT_FOR_MAIL_SERVER_SEC: 30
    #    ports:
    #      - "3000:3000"
    deploy:
      resources:
        limits:
          cpus: "0.2"
          memory: 50M
        reservations:
          memory: 10M
    restart: always

  #more details in readme.md
  mailServer:
    image: boky/postfix
    #    network_mode: host
    environment:
      - ALLOWED_SENDER_DOMAINS=localhost movietracker.site chat.movietracker.site
    ports:
      - "587:587"
      - "25:25"
    #    volumes:
    #      - ./postfix/main.cf:/etc/postfix/main.cf
    #      - ./postfix/virtual:/etc/postfix/virtual
    deploy:
      resources:
        limits:
          cpus: "0.2"
          memory: 100M
        reservations:
          memory: 10M
    restart: always
